<!doctype html>
	<head>
		<title> CS580 - Final project </title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.js"></script>
		<script type="text/javascript" src="/projects/qtip/js/jquery.qtip-1.0.0.min.js"></script>

		<script src="js/Three.js"></script>
		<script src="js/Detector.js"></script>
		<script src="js/RequestAnimationFrame.js"></script>

		<script type="text/javascript">
			var MODELS = {
			"Head" : {
					name: "Walt Disney Head",
					objPath: "obj/walt/WaltHead_bin.js",
					init_rotation: [ 0, 0, 0 ],
					scale: 5.5,
					object: null,
					materials: null
			},
			"Female" : {
					name: "Female",
					objPath: "obj/female02/Female02_bin.js",
					init_rotation: [ 0, 0, 0 ],
					scale: 5.5,
					object: null,
					materials: null
			},
			"Male" : {
					name: "Male",
					objPath: "obj/male02/Male02_bin.js",
					init_rotation: [ 0, 0, 0 ],
					scale: 5.5,
					object: null,
					materials: null
			},
			"Lucy" : {
					name: "Lucy",
					objPath: "obj/lucy/Lucy100k_bin.js",
					init_rotation: [ 0, 0, 0 ],
					scale: 5.5,
					object: null,
					materials: null
			},
			"Veyron" : {
					name:	"Bugatti Veyron",
					objPath: 	"obj/veyron/VeyronNoUv_bin.js",
					init_rotation: [ 0, 0, 0 ],
					scale: 5.5,
					object: null,
					materials: null
			},
			"Camaro" : {
					name: 	"Chevrolet Camaro",
					objPath:	"obj/camaro/CamaroNoUv_bin.js",
					init_rotation: [ 0.0, 0.0, 0.0 /*0, 1, 0*/ ],
					scale: 75,
					object:	null,
					materials: null
			}
			};
			
			var ENVIRONMENTS = {
			"Bridge" : {
					name: 	"Bridge",
					url:	"textures/cube/Bridge2/",
					object:	null
			},
			"Escher" : {
					name: 	"Escher",
					url:	"textures/cube/Escher/",
					object:	null
			},
			"Park" : {
					name: 	"Park",
					url:	"textures/cube/Park2/",
					object:	null
			}
			};
			
			$(document).ready(function() {
				$("ul.thumb li").hover(function() {
					$(this).css({
						'z-index' : '10'
					});
					/*Add a higher z-index value so this image stays on top*/
					$(this).find('img').addClass("hover").stop()/* Add class of "hover", then stop animation queue buildup*/.animate({
						width : '80px', /* Set new width */
						height : '80px', /* Set new height */
						padding : '5px'
					}, 400);
					/* this value of "200" is the speed of how fast/slow this hover animates */

				}, function() {
					$(this).css({
						'z-index' : '0'
					});
					/* Set z-index back to 0 */
					$(this).find('img').removeClass("hover").stop()/* Remove the "hover" class , then stop animation queue buildup*/.animate({
						width : '70px', /* Set width back to default */
						height : '70px', /* Set height back to default */
						padding : '2px'
					}, 200);
				});
				
			var container;
			var camera, scene, renderer;
			var cameraCube, sceneCube, cubeTarget;
			var mesh, zmesh, lightMesh, geometry;
			var loader,set1,walthead;
			var directionalLight, pointLight;
			var reflectionCube;
			var mouseX = 0;
			var mouseY = 0;
			var isMouseDown = false;
			var modID = "Head";
			
			var onMouseDownPosition, 
			radius = 2000, 
			theta = 45, 
			onMouseDownTheta = 45, 
			phi = 60, 
			onMouseDownPhi = 60;

			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;

			if(!Detector.webgl)
				Detector.addGetWebGLMessage();

			init();
			animate();
			var cubeMaterial1;
			function init() {
				set1 = 1;
				container = document.getElementById("webgl-canvas")
				
				//Zoom in/out - Change 1st attribute i.e FOV of PerspectiveCamera
				camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 3000);

				//Camera
				camera.position.x = radius * Math.sin(theta * Math.PI / 360) * Math.cos(phi * Math.PI / 360);
				camera.position.y = radius * Math.sin(phi * Math.PI / 360);
				camera.position.z = radius * Math.cos(theta * Math.PI / 360) * Math.cos(phi * Math.PI / 360);

				//Disable cameraCube in render() if you don't want the scene and only the model to move.
				cameraCube = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 100);
			
				cubeTarget = new THREE.Vector3(0, 0, 0);

				scene = new THREE.Scene();
				sceneCube = new THREE.Scene();

				onMouseDownPosition = new THREE.Vector2();

				// LIGHTS
				//Add lights
				
				var path = ENVIRONMENTS["Park"].url;
				var format = '.jpg';
				var urls = [path + 'px' + format, path + 'nx' + format, path + 'py' + format, path + 'ny' + format, path + 'pz' + format, path + 'nz' + format];

				loadCube(path,format,urls);
				
				//Web GL renderer

				renderer = new THREE.WebGLRenderer();
				//Scale scene
				renderer.setSize(window.innerWidth * 0.7, window.innerHeight*0.9);
				renderer.autoClear = false;
				container.appendChild(renderer.domElement);

				//Loader

				loader = new THREE.BinaryLoader(true);
				document.body.appendChild(loader.statusDomElement);
				
				loader.load({
					model : MODELS[modID].objPath,
					callback : function(geometry) { createScene(geometry, cubeMaterial1,modID)
					}
				});
				
				document.addEventListener('mousemove', onDocumentMouseMove, false);
				container.addEventListener('mousedown', onDocumentMouseDown, false);
				document.addEventListener('mouseup', onDocumentMouseUp, false);
				document.addEventListener('mousewheel', onDocumentMouseWheel, false);
				document.addEventListener('DOMMouseScroll', onDocumentMouseWheel, false);
			}
			function loadCube(path,format,urls)
			{
				reflectionCube = THREE.ImageUtils.loadTextureCube(urls);
				// Skybox

				var shader = THREE.ShaderUtils.lib["cube"];
				shader.uniforms["tCube"].texture = reflectionCube;

				cubeMaterial1 = new THREE.MeshLambertMaterial({
					color : 0xffffff,
					envMap : reflectionCube
				});
				
				var material = new THREE.ShaderMaterial({
					fragmentShader : shader.fragmentShader,
					vertexShader : shader.vertexShader,
					uniforms : shader.uniforms,
					depthWrite : false

				});

				var mesh = new THREE.Mesh(new THREE.CubeGeometry(100, 100, 100), material);
				mesh.flipSided = true;
				sceneCube.add(mesh);

			}
			function createScene(geometry, m1, model) {
				var mesh = new THREE.Mesh(geometry, m1);
				mesh.position.z = -100;
				mesh.scale.x = mesh.scale.y = mesh.scale.z = 10;
				MODELS[model].object = mesh;
				scene.add(mesh);
				
				loader.statusDomElement.style.display = "none";

			}

			function onDocumentMouseDown(event) {
				event.preventDefault();
				isMouseDown = true;
				onMouseDownTheta = theta;
				onMouseDownPhi = phi;
				onMouseDownPosition.x = event.clientX;
				onMouseDownPosition.y = event.clientY;
			}

			function onDocumentMouseMove(event) {
				if(isMouseDown) {
					theta = -((event.clientX - onMouseDownPosition.x ) * 0.5 ) + onMouseDownTheta;
					phi = ((event.clientY - onMouseDownPosition.y ) * 0.5 ) + onMouseDownPhi;
					phi = Math.min(90, Math.max(-90, phi));
				}
			}

			function onDocumentMouseUp(event) {
				event.preventDefault();
				isMouseDown = false;
			}

			function onDocumentMouseWheel(event) {
				if(event.wheelDeltaY) {
					radius -= event.wheelDeltaY * 1;
					// Opera / Explorer 9
				} else if(event.wheelDelta) {
					radius -= event.wheelDelta * 1;
					// Firefox
				} else if(event.detail) {
					radius += event.detail * 10.0;
				}
				radius = Math.min(3500, Math.max(1000, radius));
			}
			
			$(".models li").click(function(){
				modID = String(this.id);
				for(var m in MODELS)
				{
					if ( m != modID && MODELS[m].object ) {
						MODELS[m].object.visible = false;
					}
				}
				
				loader.load({
					model : MODELS[modID].objPath,
					callback : function(geometry) { createScene(geometry, cubeMaterial1, modID)
					}
				});
			});
			
			$(".environments li").click(function(){

				alert(this.id);
				var envID = String(this.id);
				var path = ENVIRONMENTS[envID].url;
				var format = '.jpg';
				var urls = [path + 'px' + format, path + 'nx' + format, path + 'py' + format, path + 'ny' + format, path + 'pz' + format, path + 'nz' + format];
				var x = loadCube(path,format,urls);
				for(var m in MODELS)
				{
					if (MODELS[m].object) {
						MODELS[m].object.visible = false;
					}
				}
				
			});
			
			//Animate
			function animate() {
				requestAnimationFrame(animate);
				render();
			}

			function render() {
			
				camera.position.x = radius * Math.sin(theta * Math.PI / 360) * Math.cos(phi * Math.PI / 360);
				camera.position.y = radius * Math.sin(phi * Math.PI / 360);
				camera.position.z = radius * Math.cos(theta * Math.PI / 360) * Math.cos(phi * Math.PI / 360);
				camera.updateMatrix();
				
				camera.lookAt(scene.position);

				cubeTarget.x = -camera.position.x;
				cubeTarget.y = -camera.position.y;
				cubeTarget.z = -camera.position.z;

				cameraCube.lookAt(cubeTarget);

				renderer.clear();
				
				renderer.render(sceneCube, cameraCube);
				renderer.render(scene, camera);

			}
				
			});

		</script>
		
	</head>

	<body>
		<div id = "webgl-canvas">
		</div>
			<div class="models">
				<ul class="thumb">
					<li id="Head">
						<a href="#"><img src="" alt="Head" /></a>
					</li>
					<li id="Female">
						<a href="#"><img src="" alt="Female" /></a>
					</li>
					<li id="Male">
						<a href="#"><img src="" alt="Male" /></a>
					</li>
				</ul>
				<ul class="thumb">
					<li id="Lucy">
						<a href="#"><img src="" alt="Lucy" /></a>
					</li>
					<li id="Veyron">
						<a href="#"><img src="" alt="Veyron" /></a>
					</li>
					<li id="Camaro">
						<a href="#"><img src="" alt="Camaro" /></a>
					</li>
				</ul>
				<!--ul class="thumb">
					<li>
						<a href="#"><img src="" alt="Veyron" /></a>
					</li>
					<li>
						<a href="#"><img src="" alt="Camero" /></a>
					</li>
					<li>
						<a href="#"><img src="" alt="F50" /></a>
					</li>
				</ul-->
			</div>
			<div class="environments">
				<ul class="thumb">
					<li id="Bridge">
						<a href="#"><img src="" alt="Bridge" /></a>
					</li>
					<li id="Escher">
						<a href="#"><img src="" alt="Escher" /></a>
					</li>
					<li id="Park">
						<a href="#"><img src="" alt="Park" /></a>
					</li>
				</ul>
				<!--ul class="thumb">
					<li>
						<a href="#"><img src="" alt="Pisa" /></a>
					</li>
					<li>
						<a href="#"><img src="" alt="Sky" /></a>
					</li>
					<li>
						<a href="#"><img src="" alt="Castle" /></a>
					</li>
				</ul>
				<ul class="thumb">
					<li>
						<a href="#"><img src="" alt="" /></a>
					</li>
					<li>
						<a href="#"><img src="" alt="" /></a>
					</li>
					<li>
						<a href="#"><img src="" alt="" /></a>
					</li>
				</ul-->
			</div>
	</body>
	
	<style type="text/css">
body
{
overflow: hidden;
background-color: #FFF;
}

#webgl-canvas
{
/*border-style: solid;
border-width: 1.0px;
border-color: black;
width: 896;
height: 578;
overflow: hidden;*/
margin-left: 0%;
margin-top: 2%;
}

.models
{
border-style: solid;
border-width: 2px;
border-color: black;
margin-left: 910px;
margin-top: -535px;
padding: 5px;
width: 310px;
height: 230px;
overflow: scroll;
}

.environments
{
border-style: solid;
border-width: 2px;
border-color: black;
margin-left: 910px;
margin-top: 30px;
padding: 5px;
width: 310px;
height: 230px;
overflow: scroll;
}
/* CSS for Image Effects
Reference: http://www.sohtanaka.com/web-design/fancy-thumbnail-hover-effect-w-jquery/
*/
ul.thumb {
float: left;
list-style: none;
margin: 0; padding: 8px;
width: 300px;
}
ul.thumb li {
margin: 0; padding: 40px;
float: left;
position: relative;  /* Set the absolute positioning base coordinate */
width: 20px;
height: 20px;
}
ul.thumb li img {
width: 70px; height: 70px; /* Set the small thumbnail size */
-ms-interpolation-mode: bicubic; /* IE Fix for Bicubic Scaling */
border: 1px solid #ddd;
padding: 1px;
background: #f0f0f0;
position: absolute;
left: 0; top: 0;
}
ul.thumb li img.hover {
/*background:url(thumb_bg.png) no-repeat center center;  /* Image used as background on hover effect
border: none; Get rid of border on hover */
}
	</style>
</html>